<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Database HMI Mimika</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body {
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}
input, button {
    font-family: 'Poppins', sans-serif;
}
.rounded-table th, .rounded-table td {
    border-radius: 0.5rem;
}
.table-container {
    overflow-x: auto;
    margin-top: 1rem;
}
table {
    border-collapse: separate;
    border-spacing: 0;
    width: 100%;
}
th, td {
    padding: 0.75rem 1rem;
    text-align: left;
    border-bottom: 1px solid #ddd;
    font-size: 0.95rem;
}
th {
    background: linear-gradient(135deg, #2d5016 0%, #1a1a1a 100%);
    color: #fff;
    position: sticky;
    top: 0;
    z-index: 10;
}
tr:hover {
    background-color: #f1f5f9;
}
input[type="text"], input[type="password"] {
    width: 100%;
    padding: 0.5rem;
    margin-bottom: 1rem;
    border: 2px solid #ccc;
    border-radius: 9999px; /* bubble style */
    transition: border-color 0.3s;
}
input[type="text"]:focus, input[type="password"]:focus {
    border-color: #2d5016;
    outline: none;
}
button {
    cursor: pointer;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 9999px; /* bubble button */
    transition: all 0.3s;
}
button:hover {
    opacity: 0.85;
}
#tallyFormContainer {
    transition: max-height 0.5s ease;
    overflow: hidden;
    max-height: 0;
}
</style>
</head>
<body class="h-full">

<!-- LOGIN PAGE -->
<div id="loginPage" class="min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-xl shadow-lg w-96">
        <h1 class="text-2xl font-bold text-center mb-6" style="color:#2d5016;">LOGIN HMI MIMIKA</h1>
        <input type="text" id="username" placeholder="Username">
        <div class="relative mb-4">
            <input type="password" id="password" placeholder="Password">
            <button id="togglePassword" class="absolute right-2 top-1/2 -translate-y-1/2 bg-gray-200 p-1 rounded-full text-xs">üëÅÔ∏è</button>
        </div>
        <button id="loginBtn" class="bg-green-700 text-white w-full mb-2">Login</button>
        <p class="text-center text-sm text-gray-500">Username: admin / econ / insan / lafran <br> Password: 12345</p>
    </div>
</div>

<!-- MAIN PAGE -->
<div id="mainPage" class="hidden p-6 max-w-7xl mx-auto">
    <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
        <h1 class="text-3xl font-bold" style="color:#2d5016;">DATABASE ANGGOTA HMI MIMIKA</h1>
        <div class="flex gap-2 flex-wrap">
            <button id="logoutBtn" class="bg-red-600 text-white">Logout</button>
            <button id="addMemberBtn" class="bg-green-600 text-white">Tambah Anggota</button>
        </div>
    </div>

    <div class="flex flex-col md:flex-row gap-4">
        <!-- TABEL -->
        <div id="tableContainer" class="flex-1 table-container">
            <table id="membersTable" class="rounded-table">
                <thead>
                    <tr>
                        <th>NIK</th>
                        <th>Nama Lengkap</th>
                        <th>Nomor Telepon/HP</th>
                        <th>Alamat Email</th>
                        <th>Tanggal Lahir</th>
                        <th>Alamat</th>
                        <th>Jenis Kelamin</th>
                        <th>Status Anggota</th>
                        <th>Masuk HMI Tahun</th>
                        <th>Perguruan Tinggi</th>
                        <th>Komisariat Asal</th>
                        <th>Jabatan di HMI</th>
                        <th>Posisi Jabatan</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data diisi JS -->
                </tbody>
            </table>
        </div>

        <!-- TALLY FORM -->
        <div id="tallyFormContainer" class="flex-1 bg-white p-4 rounded-xl shadow-lg">
            <button id="closeTallyBtn" class="bg-red-400 text-white mb-2">Kembali</button>
            <iframe src="https://tally.so/embed/BzxN1Q?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1" 
                    width="100%" height="600" frameborder="0" title="Tambah Anggota"></iframe>
        </div>
    </div>
</div>

<!-- SCRIPTS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkxnLr5GK_w_WRktgY-SZZ2pjBHlDVSphEYLLSBLntg0IyQB3Z5178wjaES8-yMQV7ZcMTGym-VoZA/pub?gid=0&single=true&output=csv";

const loginPage = document.getElementById("loginPage");
const mainPage = document.getElementById("mainPage");
const addMemberBtn = document.getElementById("addMemberBtn");
const tallyFormContainer = document.getElementById("tallyFormContainer");
const tableContainer = document.getElementById("tableContainer");
const closeTallyBtn = document.getElementById("closeTallyBtn");
const logoutBtn = document.getElementById("logoutBtn");
const togglePassword = document.getElementById("togglePassword");

let currentUser = null;
let membersData = [];

// Login Logic
document.getElementById("loginBtn").addEventListener("click", () => {
    const username = document.getElementById("username").value.trim().toLowerCase();
    const password = document.getElementById("password").value.trim();
    // Hardcoded access
    const users = {
        admin: "12345",
        econ: "12345",
        insan: "12345",
        lafran: "12345"
    };
    if(users[username] && users[username] === password){
        currentUser = username;
        loginPage.classList.add("hidden");
        mainPage.classList.remove("hidden");
        fetchAndRenderCSV();
    } else {
        alert("Username atau Password salah!");
    }
});

// Toggle show/hide password
togglePassword.addEventListener("click", () => {
    const pwdInput = document.getElementById("password");
    pwdInput.type = pwdInput.type === "password" ? "text" : "password";
});

// Logout
logoutBtn.addEventListener("click", () => {
    currentUser = null;
    loginPage.classList.remove("hidden");
    mainPage.classList.add("hidden");
    tallyFormContainer.style.maxHeight = "0";
});

// Show Tally Form
addMemberBtn.addEventListener("click", () => {
    tallyFormContainer.style.maxHeight = "1000px";
    tableContainer.style.display = "none";
});

// Close Tally Form
closeTallyBtn.addEventListener("click", () => {
    tallyFormContainer.style.maxHeight = "0";
    tableContainer.style.display = "block";
});

// Fetch & render CSV
function fetchAndRenderCSV() {
    Papa.parse(csvUrl, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
            membersData = results.data;
            renderTable();
        }
    });
}

function renderTable() {
    const tbody = document.querySelector("#membersTable tbody");
    tbody.innerHTML = "";
    membersData.forEach(member => {
        // Filter by user access
        if(currentUser === "econ" && member["Komisariat Asal"] !== "Komisariat Ekonomi") return;
        if(currentUser === "insan" && member["Komisariat Asal"] !== "Komisariat Insan Cita") return;
        if(currentUser === "lafran" && member["Komisariat Asal"] !== "Komisariat Lafran Pane") return;

        const row = document.createElement("tr");
        const cols = [
            "Nomor Induk Kader (NIK)",
            "Nama Lengkap",
            "Nomor Telepon/HP",
            "Alamat Email",
            "Tanggal Lahir",
            "Alamat",
            "Jenis Kelamin",
            "Status Anggota",
            "Masuk HMI Tahun",
            "Perguruan Tinggi",
            "Komisariat Asal",
            "Jabatan di HMI",
            "Posisi Jabatan"
        ];
        cols.forEach(col => {
            const td = document.createElement("td");
            td.textContent = member[col] || "-";
            row.appendChild(td);
        });
        tbody.appendChild(row);
    });
}
</script>
</body>
</html>
