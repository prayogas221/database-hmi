<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Database HMI Mimika</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; margin:0; padding:0; box-sizing:border-box; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);}
.glass-effect { backdrop-filter: blur(10px); background: rgba(255,255,255,0.9); }
.tab-content { display:none; }
.photo-popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); align-items:center; justify-content:center; z-index:1000; animation:fadeIn 0.3s ease; }
.photo-popup.active { display:flex; }
.photo-popup img { max-width:90%; max-height:90%; border-radius:12px; animation:zoomIn 0.3s ease; }
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
@keyframes zoomIn { from {transform:scale(0.5);} to {transform:scale(1);} }
.photo-thumb { cursor:pointer; transition: transform 0.2s ease; }
.photo-thumb:hover { transform: scale(1.1); }
button { cursor:pointer; }
</style>
</head>
<body class="h-full">

<!-- Login Screen -->
<div id="login-screen" class="h-full flex items-center justify-center">
  <div class="glass-effect p-8 rounded-xl shadow-xl w-96">
    <h2 class="text-2xl font-bold mb-6 text-center" style="color:#2d5016;">Login DATABASE HMI MIMIKA</h2>
    <div class="space-y-4">
      <input id="username" type="text" placeholder="Username" class="w-full px-4 py-2 rounded-lg border-2 border-gray-300 focus:border-green-500 focus:outline-none">
      <input id="password" type="password" placeholder="Password" class="w-full px-4 py-2 rounded-lg border-2 border-gray-300 focus:border-green-500 focus:outline-none">
      <button id="login-btn" class="w-full py-2 font-semibold text-white rounded-lg" style="background: linear-gradient(135deg,#2d5016 0%,#d4af37 100%);">Login</button>
      <p id="login-error" class="text-red-500 text-sm mt-2 hidden">Username atau password salah!</p>
    </div>
  </div>
</div>

<!-- Main Screen -->
<div id="main-screen" class="h-full hidden">

  <!-- Header -->
  <div class="px-6 py-4">
    <div class="max-w-7xl mx-auto rounded-2xl p-6 shadow-xl" style="background: linear-gradient(135deg, #2d5016 0%, #d4af37 100%);">
      <h1 id="site-title" class="text-3xl font-bold text-center text-white tracking-wide">DATABASE HMI MIMIKA ID</h1>
    </div>
  </div>

  <!-- Tabs -->
  <div class="max-w-7xl mx-auto px-6 pb-8">
    <div class="flex space-x-2 mb-6">
      <button id="tab-profil" class="tab-btn px-6 py-3 rounded-lg font-semibold transition-all bg-amber-700 text-white">ğŸ“‹ Profil</button>
      <button id="tab-infografis" class="tab-btn px-6 py-3 rounded-lg font-semibold transition-all bg-white text-gray-800">ğŸ“Š Infografis</button>
      <button id="tab-tambah" class="tab-btn px-6 py-3 rounded-lg font-semibold transition-all bg-white text-gray-800">â• Tambah Anggota</button>
    </div>

    <!-- Profil -->
    <div id="content-profil" class="tab-content">
      <div class="glass-effect rounded-xl p-6 shadow-lg mb-6">
        <div class="flex flex-col md:flex-row gap-4 mb-4">
          <input id="quick-search" type="text" placeholder="Cari nama, NIK, komisariat..." class="flex-1 px-4 py-2 rounded-lg border-2 border-gray-300 focus:border-green-500 focus:outline-none">
          <select id="filter-komisariat" class="px-4 py-2 rounded-lg border-2 border-gray-300 focus:border-green-500 focus:outline-none">
            <option value="all">Semua Komisariat</option>
          </select>
          <select id="filter-tahun" class="px-4 py-2 rounded-lg border-2 border-gray-300 focus:border-green-500 focus:outline-none">
            <option value="all">Semua Tahun</option>
          </select>
          <button id="reset-filter" class="px-4 py-2 rounded-lg bg-gray-300 font-semibold">Reset</button>
        </div>
        <div class="mb-4 flex justify-between items-center">
          <div>
            Tampilkan:
            <select id="rows-per-page" class="px-2 py-1 border rounded">
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="all">Semua</option>
            </select>
          </div>
          <button id="download-btn" class="px-4 py-2 rounded-lg bg-green-600 text-white font-semibold">Download CSV</button>
        </div>
        <div id="members-container" class="grid grid-cols-1 gap-4"></div>
        <div id="pagination" class="mt-4 flex justify-center space-x-2"></div>
      </div>
    </div>

    <!-- Infografis -->
    <div id="content-infografis" class="tab-content">
      <div class="glass-effect rounded-xl p-6 shadow-lg">
        <h2 class="text-2xl font-bold mb-6" style="color: #8B4513;">ğŸ“Š Statistik Anggota HMI Mimika</h2>
        <select id="chart-filter" class="mb-4 px-4 py-2 rounded-lg border-2 border-gray-300 focus:border-green-500 focus:outline-none">
          <option value="komisariat">Per Komisariat</option>
          <option value="perguruan">Per Perguruan Tinggi</option>
        </select>
        <div id="chart-container"></div>
      </div>
    </div>

    <!-- Tambah Anggota -->
    <div id="content-tambah" class="tab-content">
      <div class="glass-effect rounded-xl p-6 shadow-lg">
        <h2 class="text-2xl font-bold mb-6" style="color: #8B4513;">â• Tambah Anggota Baru</h2>
        <iframe src="https://tally.so/embed/BzxN1Q?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1" width="100%" height="700" frameborder="0" marginheight="0" marginwidth="0" title="Formulir Anggota"></iframe>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="px-6 py-6">
    <div class="max-w-7xl mx-auto text-center">
      <p id="footer-text" class="text-sm font-medium text-gray-600">IT Nesacip 2025</p>
    </div>
  </div>

  <!-- Foto Popup -->
  <div id="photo-popup" class="photo-popup" onclick="hidePhotoPopup()">
    <img id="popup-image" src="" alt="Foto Anggota">
  </div>
</div>

<script>
// === Users & Login ===
const users = {
  cabang: {password:'12345', komisariat:'all'},
  'komisariat ekonomi': {password:'12345', komisariat:'Komisariat Ekonomi'},
  'komisariat insan cita': {password:'12345', komisariat:'Komisariat Insan Cita'},
  'komisariat lafran pane': {password:'12345', komisariat:'Komisariat Lafran Pane'}
};
let currentUser = null;
document.getElementById('login-btn').addEventListener('click', ()=>{
  const u = document.getElementById('username').value.toLowerCase().trim();
  const p = document.getElementById('password').value.trim();
  if(users[u] && users[u].password===p){
    currentUser = users[u];
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('main-screen').classList.remove('hidden');
    initApp();
  } else {
    document.getElementById('login-error').classList.remove('hidden');
  }
});

// === CSV URL Spreadsheet ===
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRkxnLr5GK_w_WRktgY-SZZ2pjBHlDVSphEYLLSBLntg0IyQB3Z5178wjaES8-yMQV7ZcMTGym-VoZA/pub?output=csv';
let membersData = [];

// === Load Members ===
async function loadMembers(){
  const res = await fetch(csvUrl);
  const text = await res.text();
  const rows = text.split('\n').slice(1);
  membersData = rows.map(r=>{
    const cols = r.split(',');
    return {
      nik: cols[3] || '',
      nama: cols[4] || '',
      telp: cols[5] || '',
      email: cols[6] || '',
      tanggal_lahir: cols[7] || '',
      alamat: cols[8] || '',
      jenis_kelamin: cols[9] || '',
      status: cols[10] || '',
      tahun_masuk: cols[11] || '',
      perguruan_tinggi: cols[12] || '',
      komisariat: cols[13] || '',
      jabatan_hmi: cols[15] || '',
      posisi_jabatan: cols[16] || '',
      foto: cols[14] || ''
    };
  }).filter(m=> currentUser.komisariat==='all' || m.komisariat===currentUser.komisariat );
}

// === Render Members ===
let currentPage=1, rowsPerPage=10;
function renderMembers(){
  const container = document.getElementById('members-container');
  let data = [...membersData];
  const search = document.getElementById('quick-search').value.toLowerCase();
  if(search) data = data.filter(m=> m.nama.toLowerCase().includes(search) || m.nik.toLowerCase().includes(search) || m.komisariat.toLowerCase().includes(search));
  const totalPages = rowsPerPage==='all'?1:Math.ceil(data.length/rowsPerPage);
  if(rowsPerPage!=='all') data = data.slice((currentPage-1)*rowsPerPage, currentPage*rowsPerPage);

  container.innerHTML = data.map(m=>`
    <div class="glass-effect rounded-xl p-4 shadow-md flex flex-col md:flex-row gap-4">
      <img src="${m.foto}" class="photo-thumb w-24 h-24 rounded-lg" onclick="showPhotoPopup('${m.foto}')">
      <div class="flex-1">
        <h3 class="font-bold text-lg">${m.nama}</h3>
        <p>${m.nik}</p>
        <p>ğŸ“ ${m.telp}</p>
        <p>ğŸ“§ ${m.email}</p>
        <p>ğŸ‚ ${m.tanggal_lahir}</p>
        <p>ğŸ‘¤ ${m.jenis_kelamin}</p>
        <p>ğŸ“ ${m.alamat}</p>
        <p>âœ… ${m.status}</p>
        <p>ğŸ“… ${m.tahun_masuk}</p>
        <p>ğŸ“ ${m.perguruan_tinggi}</p>
        <p>ğŸ›ï¸ ${m.komisariat}</p>
        <p>ğŸ… ${m.jabatan_hmi} - ${m.posisi_jabatan}</p>
      </div>
    </div>
  `).join('');
  renderPagination(totalPages);
}

// === Pagination & Filter ===
function renderPagination(totalPages){
  const container = document.getElementById('pagination');
  if(totalPages<=1){container.innerHTML='';return;}
  let html='';
  for(let i=1;i<=totalPages;i++){
    html+=`<button class="px-3 py-1 border rounded ${i===currentPage?'bg-green-500 text-white':'bg-white'}" onclick="gotoPage(${i})">${i}</button>`;
  }
  container.innerHTML=html;
}
function gotoPage(p){currentPage=p;renderMembers();}
document.getElementById('quick-search').addEventListener('input', ()=>{currentPage=1; renderMembers();});
document.getElementById('rows-per-page').addEventListener('change',(e)=>{rowsPerPage=e.target.value==='all'?'all':parseInt(e.target.value);currentPage=1; renderMembers();});
document.getElementById('reset-filter').addEventListener('click', ()=>{
  document.getElementById('quick-search').value='';
  document.getElementById('rows-per-page').value=10; rowsPerPage=10; currentPage=1;
  renderMembers();
});

// === Photo Popup ===
function showPhotoPopup(src){const popup=document.getElementById('photo-popup');document.getElementById('popup-image').src=src;popup.classList.add('active');}
function hidePhotoPopup(){document.getElementById('photo-popup').classList.remove('active');}

// === Download CSV ===
document.getElementById('download-btn').addEventListener('click', ()=>{
  let csv = "NIK,Nama,Telp,Email,Tanggal Lahir,Alamat,Jenis Kelamin,Status,Tahun Masuk,Perguruan Tinggi,Komisariat,Jabatan HMI,Posisi Jabatan\n";
  membersData.forEach(m=>{
    csv+=`${m.nik},${m.nama},${m.telp},${m.email},${m.tanggal_lahir},${m.alamat},${m.jenis_kelamin},${m.status},${m.tahun_masuk},${m.perguruan_tinggi},${m.komisariat},${m.jabatan_hmi},${m.posisi_jabatan}\n`;
  });
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='HMI_Mimika.csv'; a.click(); URL.revokeObjectURL(url);
});

// === Tabs ===
function switchTab(tab){
  document.querySelectorAll('.tab-content').forEach(c=>c.style.display='none');
  document.querySelectorAll('.tab-btn').forEach(b=>{b.classList.remove('bg-amber-700'); b.classList.remove('text-white'); b.classList.add('bg-white'); b.classList.add('text-gray-800');});
  document.getElementById('content-'+tab).style.display='block';
  const btn=document.getElementById('tab-'+tab);
  btn.classList.add('bg-amber-700'); btn.classList.add('text-white');
}
document.getElementById('tab-profil').addEventListener('click', ()=>switchTab('profil'));
document.getElementById('tab-infografis').addEventListener('click', ()=>switchTab('infografis'));
document.getElementById('tab-tambah').addEventListener('click', ()=>switchTab('tambah'));

// === Infografis ===
function renderChart(type){
  const container=document.getElementById('chart-container');
  const group={};
  if(type==='komisariat'){membersData.forEach(m=>group[m.komisariat]=(group[m.komisariat]||0)+1);}
  else{membersData.forEach(m=>group[m.perguruan_tinggi]=(group[m.perguruan_tinggi]||0)+1);}
  const maxValue=Math.max(...Object.values(group));
  container.innerHTML=Object.keys(group).map(k=>{
    const val=group[k];
    const width=(val/maxValue*100)+'%';
    return `<div class="mb-4">
      <div class="flex justify-between"><span>${k}</span><span>${val} Anggota</span></div>
      <div class="w-full bg-gray-200 h-6 rounded-full"><div class="h-6 rounded-full text-white text-sm font-semibold flex items-center justify-end pr-2" style="width:${width}; background: linear-gradient(90deg,#2d5016 0%,#d4af37 100%)">${val}</div></div>
    </div>`;
  }).join('');
}
document.getElementById('chart-filter').addEventListener('change',(e)=>renderChart(e.target.value));

// === Init App ===
async function initApp(){ 
  await loadMembers(); 
  renderMembers(); 
  renderChart('komisariat'); 
  switchTab('profil');
}
</script>
</body>
</html>
