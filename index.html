<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Database HMI Mimika - Admin</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}
input, select, button {
    transition: all 0.3s;
}
input, select {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border-radius: 9999px;
    border: 2px solid #ccc;
}
input:focus, select:focus {
    border-color: #2d5016;
    box-shadow: 0 0 10px rgba(45,80,22,0.3);
    outline: none;
}
button {
    background-color: #2d5016;
    color: white;
    padding: 0.5rem 1.25rem;
    border-radius: 9999px;
    font-weight: 600;
    cursor: pointer;
}
button:hover {
    background-color: #1b2f0c;
    transform: translateY(-2px);
}
.card {
    background: white;
    border-radius: 1.5rem;
    padding: 1.5rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    margin-bottom: 1.5rem;
}
.table-container {
    overflow-x: auto;
}
table {
    border-collapse: collapse;
    width: 100%;
}
th, td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #ddd;
    font-size: 0.95rem;
    text-align: left;
}
th {
    background: linear-gradient(135deg, #2d5016 0%, #ffffff 100%);
    color: #fff;
    position: sticky;
    top: 0;
}
tr:hover {
    background-color: #f1f5f9;
}
#loginCard, #addMemberCard, #tableContainer, #searchBox, #logoutContainer {
    transition: all 0.5s ease;
}
</style>
</head>
<body class="h-full">

<div class="max-w-7xl mx-auto px-6 py-8">
    <h1 class="text-3xl font-bold text-center mb-6" style="color:#2d5016;">DATABASE ANGGOTA HMI MIMIKA</h1>

    <!-- LOGIN CARD -->
    <div id="loginCard" class="card max-w-md mx-auto">
        <h2 class="text-xl font-bold mb-4 text-center">Login Admin</h2>
        <input type="text" id="loginUsername" placeholder="Username" class="mb-4">
        <input type="password" id="loginPassword" placeholder="Password" class="mb-4">
        <button class="w-full" onclick="login()">Login</button>
        <div id="loginStatus" class="text-red-600 font-semibold mt-2 text-center"></div>
    </div>

    <!-- LOGOUT BUTTON -->
    <div id="logoutContainer" class="text-right mb-4 hidden">
        <button onclick="logout()">Logout</button>
    </div>

    <!-- Add Member Form -->
    <div id="addMemberCard" class="card hidden">
        <h2 class="font-bold mb-4 text-lg">Tambah Anggota Baru</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="text" id="addNik" placeholder="NIK">
            <input type="text" id="addNama" placeholder="Nama Lengkap">
            <input type="text" id="addTelp" placeholder="Nomor Telepon/HP">
            <input type="text" id="addEmail" placeholder="Email">
            <input type="text" id="addTglLahir" placeholder="Tanggal Lahir">
            <input type="text" id="addAlamat" placeholder="Alamat">
            <select id="addJenisKelamin">
                <option value="">Jenis Kelamin</option>
                <option value="Laki-Laki">Laki-Laki</option>
                <option value="Perempuan">Perempuan</option>
            </select>
            <select id="addStatus">
                <option value="">Status Anggota</option>
                <option value="Aktif">Aktif</option>
                <option value="Tidak Aktif">Tidak Aktif</option>
            </select>
            <input type="text" id="addTahun" placeholder="Masuk HMI Tahun">
            <input type="text" id="addPT" placeholder="Perguruan Tinggi">
            <input type="text" id="addKomisariat" placeholder="Komisariat Asal">
            <input type="text" id="addJabatan" placeholder="Jabatan di HMI">
            <input type="text" id="addPosisi" placeholder="Posisi Jabatan">
        </div>
        <div class="mt-4 flex items-center gap-3">
            <button onclick="addMember()">Tambah Anggota</button>
            <span id="addStatusMsg" class="text-green-700 font-semibold"></span>
        </div>
    </div>

    <!-- Search Box -->
    <input type="text" id="searchBox" placeholder="ðŸ” Cari nama, NIK, komisariat, atau PT..." class="mb-4 hidden">

    <!-- Table -->
    <div class="table-container hidden" id="tableContainer">
        <table id="membersTable">
            <thead>
                <tr>
                    <th>NIK</th>
                    <th>Nama Lengkap</th>
                    <th>Nomor Telepon/HP</th>
                    <th>Alamat Email</th>
                    <th>Tanggal Lahir</th>
                    <th>Alamat</th>
                    <th>Jenis Kelamin</th>
                    <th>Status Anggota</th>
                    <th>Masuk HMI Tahun</th>
                    <th>Perguruan Tinggi</th>
                    <th>Komisariat Asal</th>
                    <th>Jabatan di HMI</th>
                    <th>Posisi Jabatan</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="13" class="text-center py-4">Memuat data...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkxnLr5GK_w_WRktgY-SZZ2pjBHlDVSphEYLLSBLntg0IyQB3Z5178wjaES8-yMQV7ZcMTGym-VoZA/pub?gid=0&single=true&output=csv";
let members = [];

// LOGIN FUNCTION
function login() {
    const user = document.getElementById("loginUsername").value;
    const pass = document.getElementById("loginPassword").value;
    const status = document.getElementById("loginStatus");

    // contoh multi-level admin
    const admins = [
        {username:"admin", password:"admin"},
        {username:"cabang", password:"cabang123"}
    ];

    const valid = admins.find(a => a.username === user && a.password === pass);

    if(valid) {
        document.getElementById("loginCard").classList.add("hidden");
        document.getElementById("tableContainer").classList.remove("hidden");
        document.getElementById("addMemberCard").classList.remove("hidden");
        document.getElementById("searchBox").classList.remove("hidden");
        document.getElementById("logoutContainer").classList.remove("hidden");
        status.textContent = "";
        fetchAndRenderCSV();
    } else {
        status.textContent = "Username atau password salah!";
    }
}

// LOGOUT FUNCTION
function logout() {
    document.getElementById("loginCard").classList.remove("hidden");
    document.getElementById("tableContainer").classList.add("hidden");
    document.getElementById("addMemberCard").classList.add("hidden");
    document.getElementById("searchBox").classList.add("hidden");
    document.getElementById("logoutContainer").classList.add("hidden");
    members = [];
    document.querySelector("#membersTable tbody").innerHTML = '<tr><td colspan="13" class="text-center py-4">Memuat data...</td></tr>';
}

// FETCH CSV
function fetchAndRenderCSV() {
    Papa.parse(csvUrl, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
            members = results.data;
            renderTable(members);
        }
    });
}

// RENDER TABLE
function renderTable(data) {
    const tbody = document.querySelector("#membersTable tbody");
    tbody.innerHTML = "";
    if(!data.length){
        tbody.innerHTML = '<tr><td colspan="13" class="text-center py-4">Data tidak ditemukan</td></tr>';
        return;
    }
    data.forEach(member => {
        const row = document.createElement("tr");
        const cols = [
            "Nomor Induk Kader (NIK)",
            "Nama Lengkap",
            "Nomor Telepon/HP",
            "Alamat Email",
            "Tanggal Lahir",
            "Alamat",
            "Jenis Kelamin",
            "Status Anggota",
            "Masuk HMI Tahun",
            "Perguruan Tinggi",
            "Komisariat Asal",
            "Jabatan di HMI",
            "Posisi Jabatan"
        ];
        cols.forEach(col => {
            const td = document.createElement("td");
            td.textContent = member[col] || "-";
            row.appendChild(td);
        });
        tbody.appendChild(row);
    });
}

// SEARCH / FILTER
document.getElementById("searchBox").addEventListener("input", function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll("#membersTable tbody tr");
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? "" : "none";
    });
});

// ADD MEMBER
function addMember() {
    const newMember = {
        "Nomor Induk Kader (NIK)": document.getElementById("addNik").value,
        "Nama Lengkap": document.getElementById("addNama").value,
        "Nomor Telepon/HP": document.getElementById("addTelp").value,
        "Alamat Email": document.getElementById("addEmail").value,
        "Tanggal Lahir": document.getElementById("addTglLahir").value,
        "Alamat": document.getElementById("addAlamat").value,
        "Jenis Kelamin": document.getElementById("addJenisKelamin").value,
        "Status Anggota": document.getElementById("addStatus").value,
        "Masuk HMI Tahun": document.getElementById("addTahun").value,
        "Perguruan Tinggi": document.getElementById("addPT").value,
        "Komisariat Asal": document.getElementById("addKomisariat").value,
        "Jabatan di HMI": document.getElementById("addJabatan").value,
        "Posisi Jabatan": document.getElementById("addPosisi").value
    };

    // Tambahkan ke array lokal
    members.push(newMember);
    renderTable(members);

    // Reset form
    document.querySelectorAll('#addMemberCard input, #addMemberCard select').forEach(el=>el.value="");

    // Notifikasi
    const msg = document.getElementById("addStatusMsg");
    msg.textContent = "Anggota berhasil ditambahkan!";
    setTimeout(()=>{msg.textContent="";},3000);

    // TODO: Kirim ke Google Sheet / Tally API di sini
}
</script>

</body>
</html>
