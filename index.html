<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Database HMI Mimika - Admin</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}
input, select, button {
    transition: all 0.3s;
}
input, select {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border-radius: 9999px;
    border: 2px solid #ccc;
}
input:focus, select:focus {
    border-color: #2d5016;
    box-shadow: 0 0 10px rgba(45,80,22,0.3);
    outline: none;
}
button {
    padding: 0.5rem 1.25rem;
    border-radius: 9999px;
    font-weight: 600;
    cursor: pointer;
}
button:hover {
    transform: translateY(-2px);
}

/* LOGIN BAR */
#loginCard {
    background: linear-gradient(135deg, #2d5016 0%, #000000 100%);
    color: white;
    border-radius: 1rem;
    padding: 2rem;
    max-width: 400px;
    margin: auto;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

/* Add Member Tally Button */
#addMemberButton {
    background-color: #b5d83c; /* hijau kemeasan */
    color: white;
}
#addMemberButton:hover {
    background-color: #9cc22f;
}

/* Table */
.table-container {
    overflow-x: auto;
}
table {
    border-collapse: collapse;
    width: 100%;
}
th, td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #ddd;
    font-size: 0.95rem;
    text-align: left;
}
th {
    background: linear-gradient(135deg, #2d5016 0%, #000000 100%);
    color: #fff;
    position: sticky;
    top: 0;
}
tr:hover {
    background-color: #f1f5f9;
}

/* Layout main */
#mainContent {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
}
#tableContainer {
    flex: 1;
}
#tallyFormContainer {
    width: 400px;
    display: none;
}
</style>
</head>
<body class="h-full">

<div class="max-w-7xl mx-auto px-6 py-8">
    <h1 class="text-3xl font-bold text-center mb-6" style="color:#2d5016;">DATABASE ANGGOTA HMI MIMIKA</h1>

    <!-- LOGIN CARD -->
    <div id="loginCard">
        <h2 class="text-xl font-bold mb-4 text-center">Login Admin</h2>
        <input type="text" id="loginUsername" placeholder="Username" class="mb-4">
        <input type="password" id="loginPassword" placeholder="Password" class="mb-4">
        <button class="w-full" onclick="login()">Login</button>
        <div id="loginStatus" class="text-red-300 font-semibold mt-2 text-center"></div>
    </div>

    <!-- Logout -->
    <div id="logoutContainer" class="text-right mb-4 hidden">
        <button onclick="logout()" class="bg-black text-white px-4 py-2 rounded-full">Logout</button>
    </div>

    <!-- MAIN CONTENT -->
    <div id="mainContent" class="hidden">

        <!-- Table -->
        <div class="table-container" id="tableContainer">
            <input type="text" id="searchBox" placeholder="ðŸ” Cari nama, NIK, komisariat, atau PT..." class="mb-4">
            <table id="membersTable">
                <thead>
                    <tr>
                        <th>NIK</th>
                        <th>Nama Lengkap</th>
                        <th>Nomor Telepon/HP</th>
                        <th>Alamat Email</th>
                        <th>Tanggal Lahir</th>
                        <th>Alamat</th>
                        <th>Jenis Kelamin</th>
                        <th>Status Anggota</th>
                        <th>Masuk HMI Tahun</th>
                        <th>Perguruan Tinggi</th>
                        <th>Komisariat Asal</th>
                        <th>Jabatan di HMI</th>
                        <th>Posisi Jabatan</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="13" class="text-center py-4">Memuat data...</td></tr>
                </tbody>
            </table>
            <button id="addMemberButton" class="mt-4" onclick="showTallyForm()">+ Tambah Anggota</button>
        </div>

        <!-- Tally Form Embed -->
        <div id="tallyFormContainer">
            <iframe src="https://tally.so/embed/BzxN1Q?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1" 
                    width="100%" height="700" frameborder="0" marginheight="0" marginwidth="0"></iframe>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkxnLr5GK_w_WRktgY-SZZ2pjBHlDVSphEYLLSBLntg0IyQB3Z5178wjaES8-yMQV7ZcMTGym-VoZA/pub?gid=0&single=true&output=csv";
let members = [];

// LOGIN
function login() {
    const user = document.getElementById("loginUsername").value;
    const pass = document.getElementById("loginPassword").value;
    const status = document.getElementById("loginStatus");

    const admins = [
        {username:"admin", password:"admin"},
        {username:"cabang", password:"cabang123"}
    ];

    const valid = admins.find(a => a.username === user && a.password === pass);

    if(valid) {
        document.getElementById("loginCard").style.display = "none";
        document.getElementById("logoutContainer").classList.remove("hidden");
        document.getElementById("mainContent").classList.remove("hidden");
        status.textContent = "";
        fetchAndRenderCSV();
    } else {
        status.textContent = "Username atau password salah!";
    }
}

// LOGOUT
function logout() {
    document.getElementById("loginCard").style.display = "block";
    document.getElementById("mainContent").classList.add("hidden");
    document.getElementById("logoutContainer").classList.add("hidden");
    members = [];
    document.querySelector("#membersTable tbody").innerHTML = '<tr><td colspan="13" class="text-center py-4">Memuat data...</td></tr>';
}

// FETCH CSV
function fetchAndRenderCSV() {
    Papa.parse(csvUrl, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
            members = results.data;
            renderTable(members);
        }
    });
}

// RENDER TABLE
function renderTable(data) {
    const tbody = document.querySelector("#membersTable tbody");
    tbody.innerHTML = "";
    if(!data.length){
        tbody.innerHTML = '<tr><td colspan="13" class="text-center py-4">Data tidak ditemukan</td></tr>';
        return;
    }
    data.forEach(member => {
        const row = document.createElement("tr");
        const cols = [
            "Nomor Induk Kader (NIK)",
            "Nama Lengkap",
            "Nomor Telepon/HP",
            "Alamat Email",
            "Tanggal Lahir",
            "Alamat",
            "Jenis Kelamin",
            "Status Anggota",
            "Masuk HMI Tahun",
            "Perguruan Tinggi",
            "Komisariat Asal",
            "Jabatan di HMI",
            "Posisi Jabatan"
        ];
        cols.forEach(col => {
            const td = document.createElement("td");
            td.textContent = member[col] || "-";
            row.appendChild(td);
        });
        tbody.appendChild(row);
    });
}

// SEARCH
document.getElementById("searchBox").addEventListener("input", function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll("#membersTable tbody tr");
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? "" : "none";
    });
});

// SHOW TALLY FORM
function showTallyForm() {
    const container = document.getElementById("tallyFormContainer");
    container.style.display = container.style.display === "block" ? "none" : "block";
}
</script>

</body>
</html>
